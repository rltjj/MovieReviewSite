<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
	<title>ì˜í™” ë¦¬ë·° ì‚¬ì´íŠ¸</title>
    <link rel="stylesheet" th:href="@{/css/detailstyle.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
	<div th:replace="~{thymeleaf/menu}"></div>
	
	<br>
	
    <div class="movie-detail">
    	<img th:src="@{/images/{poster}(poster=${movie.posterImageName})}" alt="ì˜í™” í¬ìŠ¤í„°" class="movie-poster">
    
    	<div class="movie-info">
        	<h2 th:text="${movie.title}"></h2>
        	<p>ê°ë… : <span th:text="${movie.director}"></span></p>
        	<p>ì¥ë¥´ : <span th:text="${movie.genre}"></span></p>
        	<p>êµ­ê°€ : 
			    <span th:switch="${movie.isDomestic}">
			        <span th:case="'Y'">êµ­ë‚´</span>
			        <span th:case="'N'">í•´ì™¸ - <span th:text="${movie.country}"></span></span>
			    </span>
			</p>
        	<p>ê°œë´‰ì¼ : <span th:text="${movie.formattedReleaseDate}"></span></p>
        	<p>ì¤„ê±°ë¦¬: </p>
			<div class="synopsis-box">
			    <span th:utext="${#strings.trim(movie.synopsis)}"></span>
			</div>
        	
        	
        	<br>
        	
        	<p><span class="star-rating-p">í‰ê·  ë³„ì  : </span>
            	<span class="star-rating" th:attr="data-rating=${movie.averageRating != null ? movie.averageRating : 0}">
                	<i class="fa fa-star" th:each="i : ${#numbers.sequence(1,5)}"
                    	th:classappend="${i <= movie.averageRating ? 'fa-star' : 'fa-star-o'}"></i>
            		</span>
            	<span class="average-rating" th:text="${movie.averageRating != null ? movie.averageRating : 0}"></span>
        	</p>
    	</div>
	</div>
	
	<br>
	
	<div class="button-container">
    	<form th:action="@{${isBookmarked} ? '/movie/bookmark/remove' : '/movie/bookmark/' + ${movie.id}}" method="post">
			<input type="hidden" name="movieId" th:value="${movie.id}">
			<button type="submit" class="bookmark-btn" th:text="${isBookmarked ? 'ë¶ë§ˆí¬ í•´ì œ' : 'ë¶ë§ˆí¬'}"></button>
		</form>

        <form th:action="@{/movie/review/{id}(id=${movie.id})}" method="get">
        	<button type="submit" class="review-btn">ë¦¬ë·° ì‘ì„±</button>
        </form>
    </div>
    
    <br>
    
    <div class="review">
	    <h2>ë¦¬ë·° ëª©ë¡ &nbsp;<span th:text="${#lists.size(movie.reviews)}"/>ê±´</h2>
	    
	    <div th:if="${#lists.isEmpty(movie.reviews)}">
	        <p>ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë¦¬ë·°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
	    </div>
	
	    <div th:each="review : ${movie.reviews}" class="review-item">
		    <p><strong th:text="${review.username}"></strong> ë‹˜ì˜ ë¦¬ë·°</p>
		    <p th:text="${review.reviewComment}"  class="pre-line"></p>		    
		    <!-- ë³„ì  í‘œì‹œ -->
		    <p>
		        <span class="star-rating">
		            <i class="fa fa-star" th:each="i : ${#numbers.sequence(1,5)}"
		               th:classappend="${i <= review.rating ? 'fa-star' : 'fa-star-o'}"></i>
		        </span>
		        <span th:text="${review.rating}"></span>/5
		    </p>
		    <p>
			    <span th:text="${#dates.format(review.reviewCreatedAt, 'yyyy-MM-dd HH:mm')}"></span>
			    <span th:if="${#strings.equals(review.isModified, 'Y')}">(ìˆ˜ì •ë¨)</span>
			</p>
			
			<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
				<div style="display: flex; gap: 8px;">
					<form th:action="@{/review/like}" method="post" th:if="${!review.likedByCurrentUser}">
				        <input type="hidden" name="reviewId" th:value="${review.id}" />
				        <button type="submit">â¤ï¸ ì¢‹ì•„ìš”</button>
				    </form>
				    <form th:action="@{/review/unlike}" method="post" th:if="${review.likedByCurrentUser}">
				        <input type="hidden" name="reviewId" th:value="${review.id}" />
				        <button type="submit">ğŸ’” ì·¨ì†Œ</button>
				    </form>
				    <span th:text="'ì¢‹ì•„ìš” ' + ${review.likeCount} + 'ê°œ'"></span>
				</div>
			    
			    <div th:if="${review.username == username}" style="display: flex; justify-content: flex-end; gap: 20px; align-items: center;">
		            <button th:onclick="'window.location.href=\'/review/edit/' + ${review.id} + '\''">ìˆ˜ì •</button>
		            <form action="/review/delete" method="post" onsubmit="return confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
		                    <input type="hidden" name="reviewId" th:value="${review.id}">
		                    <button type="submit">ì‚­ì œ</button>
		            </form>
		        </div>
			</div>
		</div>
	</div>

	<br>

	<div th:replace="~{thymeleaf/footer}"></div>
	
	<script>
		document.addEventListener("DOMContentLoaded", function() {
    		let poster = document.querySelector(".movie-poster");
    		let movieInfo = document.querySelector(".movie-info");

    		if (poster && movieInfo) {
       	 		movieInfo.style.minHeight = poster.clientHeight + "px"; // í¬ìŠ¤í„° ë†’ì´ì— ë§ì¶¤
    		}
		});
	</script>

</body>
</html>